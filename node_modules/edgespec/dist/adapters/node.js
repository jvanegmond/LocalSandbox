import http from "node:http";
import { transformToNodeBuilder } from "../edge/transform-to-node.js";
export const getNodeHandler = (edgeSpec, { port, middleware = [] }) => {
    const transformToNode = transformToNodeBuilder({
        defaultOrigin: `http://localhost${port ? `:${port}` : ""}`,
    });
    return transformToNode((req) => edgeSpec.makeRequest(req, {
        middleware,
    }));
};
export const startServer = async (edgeSpec, opts) => {
    const server = http.createServer(getNodeHandler(edgeSpec, opts));
    const { port } = opts;
    await new Promise((resolve) => server.listen(port, resolve));
    return server;
};
