import test from "ava"
import { getVirtualFileSystemFromDirPath, writeVfsToDirectory } from "index"
import mockFS from "mock-fs"

test("generate vfs from directory", async (t) => {
  mockFS({})

  const vfs = {
    "/app/noinclude.txt": "should not include",
    "/app/somedir/file1.txt": "this is file1 content",
    "/app/somedir/file2.js": "console.log('hello world')",
  }

  await writeVfsToDirectory({
    vfs,
    vfsDir: "/app/somedir",
    outDir: "/nested/newdir",
  })

  const new_vfs = await getVirtualFileSystemFromDirPath({
    dirPath: "/nested/newdir",
    contentFormat: "string",
  })

  t.deepEqual(new_vfs, {
    "file1.txt": "this is file1 content",
    "file2.js": "console.log('hello world')",
  })
})
